# Record Server

Raspberry Piを使用した動画記録サーバー。Logicool C920nウェブカメラからの映像を定期的に記録し、指定された時間範囲の映像を提供するAPIサーバーです。

## 機能

- 5分間隔での動画記録
- 2時間分の動画データを保持
- FastAPIを使用したRESTful API
- タイムスタンプ指定による動画クリップの取得（前後20秒）

## システム要件

- Raspberry Pi (推奨: Raspberry Pi 4)
- Logicool C920nウェブカメラ
- Python 3.11以上
- 十分なストレージ容量（2時間分の動画保存用）

## セットアップ

1. 必要なパッケージのインストール:
```bash
./setup.sh
```

2. 環境変数の設定:
```bash
cp .env.example .env
# .envファイルを編集して必要な設定を行う
```

## 使用方法

1. サーバーの起動:
```bash
python main.py
```

2. APIエンドポイント:
- `GET /api/video/{timestamp}`: 指定されたタイムスタンプの前後20秒の動画を取得
  - パラメータ:
    - `timestamp`: ISO 8601形式のタイムスタンプ (例: `2024-03-20T15:30:00Z`)

## 設計

### アーキテクチャ

1. 動画記録モジュール
   - OpenCVを使用したウェブカメラからの映像取得
   - 5分間隔での動画ファイル生成
   - 古い動画ファイルの自動削除（2時間以上前のデータ）

2. ストレージ管理
   - 動画ファイルは日時ベースでディレクトリ構造化
   - ファイル名は記録開始時刻を含む
   - 定期的なクリーンアップ処理

3. APIサーバー
   - FastAPIによるRESTful API実装
   - タイムスタンプに基づく動画クリップの検索と提供
   - エラーハンドリングとバリデーション
   
## ライセンス

MIT License
